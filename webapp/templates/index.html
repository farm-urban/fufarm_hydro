<!DOCTYPE html>
<title>JavaScript Example</title>
<link
  rel="stylesheet"
  href="https://unpkg.com/normalize.css@8.0.1/normalize.css"
/>
<link
  rel="stylesheet"
  href="https://unpkg.com/sakura.css@1.3.1/css/sakura.css"
/>
<style>
  .group {
    display: flex;
    flex-direction: row;
  }
  form {
    display: flex;
  }
  label > input {
    width: 3em;
  }
  form > * {
    padding-right: 1em;
  }
  #result {
    font-weight: bold;
  }
</style>

<h1>FuFarm Autodoser</h1>
<hr />
<h4>Control Panel</h4>
<div class="group">
  <label for="select">Mode: </label>
  <select id="select">
    <optgroup label="Mode">
      <option value="monitor">Monitor</option>
      <option value="control">Control</option>
    </optgroup>
  </select>
</div>
<div class="group">
  <label for="calibrate">Run Calibration: </label>
  <input id="calibrate-btn" type="submit" value="Calibrate" />
</div>
<hr />
<div class="group">
  <label for="current-ec">Current EC:&nbsp</label>
  <output id="current-ec">42</output>
</div>
<div class="group">
  <label for="last-doestime">Last Dose Time:&nbsp</label>
  <output id="last-doestime">14:15</output>
</div>
<hr />
<h4>Set Parameters</h4>
<form id="set-parameters">
  <div>
    <div class="group">
      <label for="target-ec">Target EC: </label>
      <input id="target-ec" type="number" step="0.1" placeholder="1.8" />
    </div>
    <div class="group">
      <label for="equilibration-time">EquilibrationTime (s): </label>
      <input id="equilibration-time" type="number" step="1" placeholder="300" />
    </div>
    <div class="group">
      <label for="dose-duration">Dose duration (s): </label>
      <input id="dose-duration" type="number" step="1" placeholder="10" />
    </div>
    <div class="group">
      <label>a: </label>
      <input name="a" type="number" step="0.01" />
    </div>
    <div class="group">
      <label>b: </label>
      <input name="b" type="number" step="0.01" />
    </div>
    <input type="submit" value="Calculate" />
  </div>
</form>
<span>= <span id="result"></span></span>

<script>
  function addSubmit(ev) {
    ev.preventDefault();
    fetch({{ url_for('add')|tojson }}, {
      method: 'POST',
      body: new FormData(this)
    })
      .then(parseJSON)
      .then(addShow);
  }

  function parseJSON(response) {
    return response.json();
  }

  function addShow(data) {
    var span = document.getElementById('result');
    span.innerText = data.result;
  }

  var form = document.getElementById('calc');
  form.addEventListener('submit', addSubmit);
</script>
